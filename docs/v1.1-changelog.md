# Memory System v1.1 æ›´æ–°æ—¥å¿—

**å‘å¸ƒæ—¥æœŸ**: 2026-02-05  
**ç‰ˆæœ¬**: v1.0 â†’ v1.1  
**çŠ¶æ€**: âœ… å®Œæˆå¹¶æµ‹è¯•é€šè¿‡

---

## ğŸ¯ æ–°å¢åŠŸèƒ½

### 1. è®¿é—®æ—¥å¿—è¿½è¸ªç³»ç»Ÿ
- **åŠŸèƒ½**: è®°å½•è®°å¿†ä½¿ç”¨é¢‘ç‡ï¼Œå¸¸ç”¨è®°å¿†æƒé‡æ›´é«˜
- **è®¿é—®ç±»å‹æƒé‡**:
  - `retrieval`: 1.0ï¼ˆæ£€ç´¢åˆ°ä½†æœªä½¿ç”¨ï¼‰
  - `used_in_response`: 2.0ï¼ˆç”¨äºç”Ÿæˆå›å¤ï¼‰
  - `user_mentioned`: 3.0ï¼ˆç”¨æˆ·ä¸»åŠ¨æåŠï¼‰
- **åŠ æˆå…¬å¼**: `boost = ln(weighted_count + 1) * (weighted_count / days) * 0.2`
- **æœ€å¤§åŠ æˆ**: 50%

### 2. æ—¶é—´æ•æ„Ÿè®°å¿†ç³»ç»Ÿ
- **ä¸‰çº§è¿‡æ»¤æ¼æ–—**:
  - **ç¬¬ä¸€çº§**: å¼ºåŒ¹é…æ± ï¼ˆæ­£åˆ™ï¼Œ0 Tokenï¼‰
  - **ç¬¬äºŒçº§**: LLM ä»‹å…¥ï¼ˆç°è‰²åœ°å¸¦ 0.35-0.70ï¼‰
  - **ç¬¬ä¸‰çº§**: å®ä½“çƒ­åº¦è¿½è¸ªï¼ˆé»˜è®¤ 3 å¤©ä¿è´¨æœŸï¼‰
- **è¿‡æœŸæ—¶é—´é…ç½®**:
  - ç«‹å³ä»»åŠ¡ï¼ˆä»Šå¤©ï¼‰: 12 å°æ—¶
  - çŸ­æœŸä»»åŠ¡ï¼ˆæ˜å¤©ï¼‰: 2 å¤©
  - ä¸­æœŸä»»åŠ¡ï¼ˆè¿™å‘¨ï¼‰: 10 å¤©
  - é•¿æœŸä»»åŠ¡ï¼ˆè¿™ä¸ªæœˆï¼‰: 35 å¤©

### 3. è®¿é—®ä¿æŠ¤è¡°å‡
- **ä¿æŠ¤æœŸ**:
  - 3 å¤©å†…è®¿é—®: å‡ ä¹ä¸è¡°å‡ï¼ˆ0.99ï¼‰
  - 7 å¤©å†…è®¿é—®: è½»å¾®è¡°å‡ï¼ˆ0.97ï¼‰
  - 14 å¤©å†…è®¿é—®: æ­£å¸¸è¡°å‡ï¼ˆ0.95ï¼‰
  - è¶…è¿‡ 14 å¤©: æŒ‰åŸºç¡€è¡°å‡ç‡

---

## ğŸ“‚ æ–°å¢æ–‡ä»¶

### æ ¸å¿ƒæ¨¡å—
- `scripts/v1_1_config.py` - v1.1 é…ç½®å¸¸é‡
- `scripts/v1_1_helpers.py` - v1.1 è¾…åŠ©å‡½æ•°
- `scripts/v1_1_commands.py` - v1.1 å‘½ä»¤è¡Œæ¥å£

### æ•°æ®æ–‡ä»¶
- `layer2/access_log.jsonl` - è®¿é—®æ—¥å¿—
- `layer2/expired_log.jsonl` - è¿‡æœŸè®°å¿†å½’æ¡£

### æµ‹è¯•æ–‡ä»¶
- `scripts/test_v1.1.py` - åŠŸèƒ½æµ‹è¯•è„šæœ¬

---

## ğŸ”„ æ›´æ–°çš„å·¥ä½œæµç¨‹

### Consolidation æµç¨‹ï¼ˆ7 Phase â†’ 8 Phaseï¼‰

```
Phase 0: æ¸…ç†è¿‡æœŸè®°å¿†ï¼ˆæ–°å¢ï¼‰
    â†“
Phase 1: æå–åŸå§‹è®°å¿†
    â”œâ”€ ç¬¬ä¸€çº§ï¼šå¼ºåŒ¹é…æ± ï¼ˆæ­£åˆ™ï¼‰
    â”œâ”€ ç¬¬äºŒçº§ï¼šLLM ä»‹å…¥ï¼ˆç°è‰²åœ°å¸¦ï¼‰
    â””â”€ ç¬¬ä¸‰çº§ï¼šå®ä½“çƒ­åº¦è¿½è¸ª
    â†“
Phase 2: è§„åˆ™è¿‡æ»¤
    â†“
Phase 3: æ¨¡æ¿æå–ï¼ˆæ–°å¢æ—¶é—´æ•æ„Ÿå­—æ®µï¼‰
    â†“
Phase 4a: LLM åˆ†ç±»
    â†“
Phase 4b: ä»£ç éªŒè¯
    â†“
Phase 5: æ’åï¼ˆæ–°å¢è®¿é—®åŠ æˆï¼‰
    â”œâ”€ 5a: åº”ç”¨è®¿é—®åŠ æˆ
    â””â”€ 5b: è¡°å‡æ›´æ–°ï¼ˆå«è®¿é—®ä¿æŠ¤ï¼‰
    â†“
Phase 6: ç´¢å¼•æ›´æ–°
    â†“
Phase 7: ç”Ÿæˆå¿«ç…§
```

---

## ğŸ“Š æ•°æ®ç»“æ„å˜æ›´

### è®°å¿†æ¡ç›®æ–°å¢å­—æ®µ

```json
{
  "id": "fact_20260205_a3f2e1",
  "type": "fact",
  "content": "[ç”¨æˆ·] å–œæ¬¢è½»æ¾äº’åŠ¨é£æ ¼",
  "importance": 0.8,
  "confidence": 0.95,
  "created_at": "2026-02-05T13:00:00Z",
  "last_updated": "2026-02-05T13:00:00Z",
  "entities": ["[ç”¨æˆ·]"],
  "tags": ["user_preference"],
  
  // ===== v1.1 æ–°å¢å­—æ®µ =====
  
  // æ—¶é—´æ•æ„Ÿ
  "expires_at": null,              // ISO æ—¶é—´æˆ³æˆ– null
  "is_permanent": true,            // æ˜¯å¦æ°¸ä¹…è®°å¿†
  
  // è®¿é—®è¿½è¸ª
  "access_count": 15,              // æ€»è®¿é—®æ¬¡æ•°
  "retrieval_count": 10,           // æ£€ç´¢æ¬¡æ•°
  "used_in_response_count": 5,    // ç”¨äºå›å¤æ¬¡æ•°
  "user_mentioned_count": 2,       // ç”¨æˆ·æåŠæ¬¡æ•°
  "last_accessed": "2026-02-05T14:00:00Z",
  "access_boost": 0.35,            // è®¿é—®é¢‘ç‡åŠ æˆ
  
  // ç¬¬ä¸‰çº§è¿½è¸ª
  "tier3_tracked": false,          // æ˜¯å¦è¢«ç¬¬ä¸‰çº§è¿½è¸ª
  "reactivation_count": 0,         // å†æ¿€æ´»æ¬¡æ•°
  
  // æ’å
  "final_score": 1.026             // æœ€ç»ˆåˆ†æ•°ï¼ˆå«åŠ æˆï¼‰
}
```

---

## ğŸ› ï¸ æ–°å¢å‘½ä»¤

### 1. Phase 0 æ”¯æŒ
```bash
# æ‰§è¡Œ Phase 0ï¼ˆæ¸…ç†è¿‡æœŸè®°å¿†ï¼‰
python3 memory.py consolidate --phase 0

# å®Œæ•´ Consolidationï¼ˆåŒ…å« Phase 0ï¼‰
python3 memory.py consolidate --force
```

### 2. è®¿é—®æ—¥å¿—ç®¡ç†
```bash
# è®°å½•è®¿é—®
python3 memory.py record-access <memory_id> --type retrieval
python3 memory.py record-access <memory_id> --type used_in_response --query "ç”¨æˆ·æŸ¥è¯¢"
python3 memory.py record-access <memory_id> --type user_mentioned

# æŸ¥çœ‹è®¿é—®æ—¥å¿—
python3 memory.py view-access-log --limit 20

# æŸ¥çœ‹è¿‡æœŸè®°å¿†æ—¥å¿—
python3 memory.py view-expired-log --limit 20
```

---

## âš™ï¸ é…ç½®æ›´æ–°

### config.json æ–°å¢é…ç½®

```json
{
  "version": "1.1",
  
  // v1.0 ä¿æŒä¸å˜
  "decay_rates": { ... },
  "thresholds": { ... },
  "token_budget": { ... },
  "consolidation": { ... },
  
  // ===== v1.1 æ–°å¢ =====
  
  "funnel": {
    "tier2_threshold_lower": 0.35,
    "tier2_threshold_upper": 0.70,
    "tier3_default_ttl_days": 3,
    "tier3_reactivation_extend_days": 3,
    "tier3_max_ttl_days": 14
  },
  
  "access_tracking": {
    "enabled": true,
    "boost_coefficient": 0.2,
    "max_boost": 0.5,
    "weights": {
      "retrieval": 1.0,
      "used_in_response": 2.0,
      "user_mentioned": 3.0
    },
    "protection_days": {
      "strong": 3,
      "medium": 7,
      "weak": 14
    }
  },
  
  "time_sensitivity": {
    "enabled": true,
    "immediate_hours": 12,
    "short_term_days": 2,
    "medium_term_days": 10,
    "long_term_days": 35,
    "event_after_hours": 2
  }
}
```

---

## ğŸ§ª æµ‹è¯•ç»“æœ

### æµ‹è¯•è„šæœ¬
```bash
cd /root/memory-system-skill/scripts
python3 test_v1.1.py
```

### æµ‹è¯•è¦†ç›–
- âœ… ç¬¬ä¸€çº§å¼ºåŒ¹é…ï¼ˆæ­£åˆ™æ¨¡å¼ï¼‰
- âœ… è®¿é—®åŠ æˆè®¡ç®—ï¼ˆå¯¹æ•°å…¬å¼ï¼‰
- âœ… æ—¶é—´æ•æ„Ÿæ£€æµ‹ï¼ˆè¿‡æœŸæ—¶é—´ï¼‰
- âœ… è¡°å‡ä¿æŠ¤ï¼ˆè®¿é—®ä¿æŠ¤æœŸï¼‰

### æµ‹è¯•ç»“æœ
```
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
- ç¬¬ä¸€çº§å¼ºåŒ¹é…: 5/5 é€šè¿‡
- è®¿é—®åŠ æˆè®¡ç®—: æ­£ç¡®ï¼ˆ50% åŠ æˆï¼‰
- æ—¶é—´æ•æ„Ÿæ£€æµ‹: 4/4 é€šè¿‡
- è¡°å‡ä¿æŠ¤: 3/3 é€šè¿‡
```

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: æ·»åŠ æ—¶é—´æ•æ„Ÿè®°å¿†
```bash
# æ·»åŠ ä¸€ä¸ª"æ˜å¤©å¼€ä¼š"çš„è®°å¿†
python3 memory.py capture "æ˜å¤©ä¸‹åˆ3ç‚¹å¼€ä¼š" --type fact --importance 0.7

# ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
# 1. æ£€æµ‹åˆ°"æ˜å¤©"å…³é”®è¯
# 2. è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º 2 å¤©å
# 3. æ ‡è®°ä¸ºéæ°¸ä¹…è®°å¿†
```

### ç¤ºä¾‹ 2: è®°å½•è®¿é—®å¹¶æŸ¥çœ‹åŠ æˆ
```bash
# è®°å½•ç”¨æˆ·æåŠ
python3 memory.py record-access fact_20260205_abc123 --type user_mentioned

# æŸ¥çœ‹è®¿é—®ç»Ÿè®¡
python3 memory.py view-access-log --limit 10

# æ‰§è¡Œ Consolidation åï¼Œè¯¥è®°å¿†çš„ final_score ä¼šæå‡
python3 memory.py consolidate --force
```

### ç¤ºä¾‹ 3: æ¸…ç†è¿‡æœŸè®°å¿†
```bash
# åªæ‰§è¡Œ Phase 0ï¼ˆæ¸…ç†è¿‡æœŸï¼‰
python3 memory.py consolidate --phase 0

# æŸ¥çœ‹è¿‡æœŸæ—¥å¿—
python3 memory.py view-expired-log --limit 20
```

---

## ğŸ”§ å‘åå…¼å®¹æ€§

- âœ… v1.0 çš„è®°å¿†æ•°æ®å¯ä»¥æ­£å¸¸è¿ç§»
- âœ… æ–°å¢å­—æ®µæœ‰é»˜è®¤å€¼ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½
- âœ… v1.1 æ¨¡å—å¯¼å…¥å¤±è´¥æ—¶ï¼Œè‡ªåŠ¨é™çº§åˆ° v1.0 åŠŸèƒ½

---

## ğŸš€ ä¸‹ä¸€æ­¥

### ç«‹å³å¯ç”¨
- æ‰€æœ‰ v1.1 åŠŸèƒ½å·²å®ç°å¹¶æµ‹è¯•é€šè¿‡
- å¯ä»¥ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨

### æœªæ¥ä¼˜åŒ–ï¼ˆv1.2ï¼‰
- æ¥å…¥çœŸå® LLM APIï¼ˆç¬¬äºŒçº§ LLM ä»‹å…¥ï¼‰
- å®ä½“çƒ­åº¦è¿½è¸ªçš„è‡ªåŠ¨å­¦ä¹ 
- è®¿é—®æ—¥å¿—çš„å¯è§†åŒ–åˆ†æ

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- **å®Œæ•´è®¾è®¡**: `/root/.openclaw/workspace/memory-system-v1.1-complete-design.md`
- **é¡¹ç›®æ—¥å¿—**: `/root/.openclaw/workspace/memory/2026-02-05-memory-v1.1-project-log.md`
- **æµ‹è¯•è„šæœ¬**: `/root/memory-system-skill/scripts/test_v1.1.py`

---

**æ›´æ–°å®Œæˆï¼** ğŸ¦
