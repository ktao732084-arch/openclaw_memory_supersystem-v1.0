# Memory System v1.1 ä½¿ç”¨æŒ‡å—

## å¿«é€Ÿå¼€å§‹

### 1. åˆå§‹åŒ–ç³»ç»Ÿ
```bash
cd /root/memory-system-skill/scripts
python3 memory.py init
```

### 2. æ·»åŠ æµ‹è¯•è®°å¿†
```bash
# æ°¸ä¹…è®°å¿†
python3 memory.py capture "æˆ‘å«å¼ ä¸‰" --type fact --importance 1.0

# æ—¶é—´æ•æ„Ÿè®°å¿†
python3 memory.py capture "æ˜å¤©ä¸‹åˆ3ç‚¹å¼€ä¼š" --type fact --importance 0.7

# åå¥½è®°å¿†
python3 memory.py capture "æˆ‘å–œæ¬¢åƒè‹¹æœ" --type fact --importance 0.8
```

### 3. æ‰§è¡Œ Consolidation
```bash
# å®Œæ•´æ‰§è¡Œï¼ˆåŒ…å« Phase 0 æ¸…ç†è¿‡æœŸè®°å¿†ï¼‰
python3 memory.py consolidate --force

# åªæ‰§è¡Œ Phase 0ï¼ˆæ¸…ç†è¿‡æœŸï¼‰
python3 memory.py consolidate --phase 0
```

### 4. æ£€ç´¢è®°å¿†
```bash
# æ™ºèƒ½æ£€ç´¢
python3 memory.py search "æˆ‘çš„åå­—æ˜¯ä»€ä¹ˆ"

# æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
python3 memory.py status

# æŸ¥çœ‹è¯¦ç»†ç»Ÿè®¡
python3 memory.py stats
```

---

## v1.1 æ–°åŠŸèƒ½ä½¿ç”¨

### è®¿é—®æ—¥å¿—è¿½è¸ª

#### è®°å½•è®¿é—®
```bash
# è®°å½•æ£€ç´¢è®¿é—®
python3 memory.py record-access fact_20260205_abc123 --type retrieval

# è®°å½•ç”¨äºå›å¤
python3 memory.py record-access fact_20260205_abc123 --type used_in_response --query "ç”¨æˆ·é—®äº†ä»€ä¹ˆ"

# è®°å½•ç”¨æˆ·æåŠ
python3 memory.py record-access fact_20260205_abc123 --type user_mentioned
```

#### æŸ¥çœ‹è®¿é—®æ—¥å¿—
```bash
# æŸ¥çœ‹æœ€è¿‘ 20 æ¡è®¿é—®è®°å½•
python3 memory.py view-access-log --limit 20

# æŸ¥çœ‹æœ€è¿‘ 50 æ¡
python3 memory.py view-access-log --limit 50
```

#### è®¿é—®åŠ æˆæ•ˆæœ
```python
# ç¤ºä¾‹ï¼šä¸€ä¸ªè®°å¿†çš„è®¿é—®ç»Ÿè®¡
{
  "id": "fact_20260205_abc123",
  "content": "Ktao å–œæ¬¢è½»æ¾äº’åŠ¨é£æ ¼",
  "importance": 0.8,
  "retrieval_count": 10,           # æ£€ç´¢ 10 æ¬¡
  "used_in_response_count": 5,    # ç”¨äºå›å¤ 5 æ¬¡
  "user_mentioned_count": 2,       # ç”¨æˆ·æåŠ 2 æ¬¡
  "access_boost": 0.35,            # è®¿é—®åŠ æˆ 35%
  "final_score": 1.08              # æœ€ç»ˆåˆ†æ•° = 0.8 * (1 + 0.35)
}
```

### æ—¶é—´æ•æ„Ÿè®°å¿†

#### è‡ªåŠ¨æ£€æµ‹
ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ä»¥ä¸‹æ¨¡å¼ï¼š

```python
# ç«‹å³ä»»åŠ¡ï¼ˆ12 å°æ—¶è¿‡æœŸï¼‰
"ä»Šå¤©æ™šä¸Š8ç‚¹å¼€ä¼š"
"ç°åœ¨é©¬ä¸Šå»è¶…å¸‚"

# çŸ­æœŸä»»åŠ¡ï¼ˆ2 å¤©è¿‡æœŸï¼‰
"æ˜å¤©å»åŒ»é™¢"
"åå¤©äº¤æŠ¥å‘Š"

# ä¸­æœŸä»»åŠ¡ï¼ˆ10 å¤©è¿‡æœŸï¼‰
"è¿™å‘¨å®Œæˆé¡¹ç›®"
"ä¸‹å‘¨è§é¢"

# é•¿æœŸä»»åŠ¡ï¼ˆ35 å¤©è¿‡æœŸï¼‰
"è¿™ä¸ªæœˆåº•æäº¤"
"ä¸‹ä¸ªæœˆæ—…è¡Œ"

# æ°¸ä¹…è®°å¿†ï¼ˆä¸è¿‡æœŸï¼‰
"æˆ‘å«å¼ ä¸‰"
"æˆ‘å¯¹èŠ±ç”Ÿè¿‡æ•"
"æˆ‘å–œæ¬¢åƒè‹¹æœ"
```

#### æŸ¥çœ‹è¿‡æœŸæ—¥å¿—
```bash
# æŸ¥çœ‹æœ€è¿‘è¿‡æœŸçš„è®°å¿†
python3 memory.py view-expired-log --limit 20
```

#### æ‰‹åŠ¨æ¸…ç†è¿‡æœŸè®°å¿†
```bash
# æ‰§è¡Œ Phase 0
python3 memory.py consolidate --phase 0
```

---

## å®Œæ•´å·¥ä½œæµç¤ºä¾‹

### åœºæ™¯ï¼šæ—¥å¸¸å¯¹è¯è®°å¿†ç®¡ç†

#### ç¬¬ 1 å¤©ï¼šæ·»åŠ è®°å¿†
```bash
# ç”¨æˆ·è¯´ï¼š"æˆ‘å«æå››ï¼Œæ˜å¤©ä¸‹åˆ3ç‚¹è¦å¼€ä¼šï¼Œæˆ‘å–œæ¬¢å–å’–å•¡"

# ç³»ç»Ÿè‡ªåŠ¨æå–å¹¶åˆ†ç±»ï¼š
# 1. "æˆ‘å«æå››" â†’ æ°¸ä¹…è®°å¿†ï¼Œimportance=1.0
python3 memory.py capture "æˆ‘å«æå››" --type fact --importance 1.0

# 2. "æ˜å¤©ä¸‹åˆ3ç‚¹è¦å¼€ä¼š" â†’ æ—¶é—´æ•æ„Ÿï¼Œ2å¤©è¿‡æœŸ
python3 memory.py capture "æ˜å¤©ä¸‹åˆ3ç‚¹è¦å¼€ä¼š" --type fact --importance 0.7

# 3. "æˆ‘å–œæ¬¢å–å’–å•¡" â†’ æ°¸ä¹…è®°å¿†ï¼Œimportance=0.8
python3 memory.py capture "æˆ‘å–œæ¬¢å–å’–å•¡" --type fact --importance 0.8
```

#### ç¬¬ 2 å¤©ï¼šæ£€ç´¢å’Œè®¿é—®
```bash
# ç”¨æˆ·é—®ï¼š"æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ"
python3 memory.py search "æˆ‘å«ä»€ä¹ˆåå­—"

# ç³»ç»Ÿè¿”å›ï¼š"æˆ‘å«æå››"
# è®°å½•è®¿é—®
python3 memory.py record-access fact_20260205_001 --type used_in_response --query "æˆ‘å«ä»€ä¹ˆåå­—"

# ç”¨æˆ·é—®ï¼š"æˆ‘å–œæ¬¢å–ä»€ä¹ˆï¼Ÿ"
python3 memory.py search "æˆ‘å–œæ¬¢å–ä»€ä¹ˆ"

# ç³»ç»Ÿè¿”å›ï¼š"æˆ‘å–œæ¬¢å–å’–å•¡"
# è®°å½•è®¿é—®
python3 memory.py record-access fact_20260205_003 --type used_in_response --query "æˆ‘å–œæ¬¢å–ä»€ä¹ˆ"
```

#### ç¬¬ 3 å¤©ï¼šConsolidation
```bash
# æ‰§è¡Œ Consolidation
python3 memory.py consolidate --force

# ç³»ç»Ÿä¼šï¼š
# 1. æ¸…ç†è¿‡æœŸè®°å¿†ï¼ˆ"æ˜å¤©ä¸‹åˆ3ç‚¹è¦å¼€ä¼š"å·²è¿‡æœŸï¼‰
# 2. åº”ç”¨è®¿é—®åŠ æˆï¼ˆ"æˆ‘å«æå››"å’Œ"æˆ‘å–œæ¬¢å–å’–å•¡"æƒé‡æå‡ï¼‰
# 3. æ›´æ–°æ’åå’Œå¿«ç…§
```

#### æŸ¥çœ‹ç»“æœ
```bash
# æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
python3 memory.py status

# æŸ¥çœ‹è®¿é—®æ—¥å¿—
python3 memory.py view-access-log --limit 10

# æŸ¥çœ‹è¿‡æœŸæ—¥å¿—
python3 memory.py view-expired-log --limit 10

# æŸ¥çœ‹è¯¦ç»†ç»Ÿè®¡
python3 memory.py stats
```

---

## é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰é…ç½®

ç¼–è¾‘ `memory/config.json`ï¼š

```json
{
  "version": "1.1",
  
  // è®¿é—®è¿½è¸ªé…ç½®
  "access_tracking": {
    "enabled": true,
    "boost_coefficient": 0.2,      // è°ƒæ•´åŠ æˆç³»æ•°
    "max_boost": 0.5,              // è°ƒæ•´æœ€å¤§åŠ æˆ
    "weights": {
      "retrieval": 1.0,
      "used_in_response": 2.0,
      "user_mentioned": 3.0        // è°ƒæ•´æƒé‡
    }
  },
  
  // æ—¶é—´æ•æ„Ÿé…ç½®
  "time_sensitivity": {
    "enabled": true,
    "immediate_hours": 12,         // è°ƒæ•´ç«‹å³ä»»åŠ¡è¿‡æœŸæ—¶é—´
    "short_term_days": 2,          // è°ƒæ•´çŸ­æœŸä»»åŠ¡è¿‡æœŸæ—¶é—´
    "medium_term_days": 10,
    "long_term_days": 35
  }
}
```

### æ‰¹é‡æ“ä½œ

#### æ‰¹é‡æ·»åŠ è®°å¿†
```bash
# ä»æ–‡ä»¶è¯»å–
cat > test_input.txt << EOF
æˆ‘å«å¼ ä¸‰
æˆ‘å¯¹èŠ±ç”Ÿè¿‡æ•
æ˜å¤©ä¸‹åˆ3ç‚¹å¼€ä¼š
æˆ‘å–œæ¬¢åƒè‹¹æœ
EOF

# æ‰§è¡Œ Consolidationï¼ˆä¼šè‡ªåŠ¨æå–ï¼‰
python3 memory.py consolidate --force --input test_input.txt
```

#### æ‰¹é‡æŸ¥çœ‹è®°å¿†
```bash
# æŸ¥çœ‹æ‰€æœ‰æ´»è·ƒè®°å¿†
cd /root/.openclaw/workspace/memory/layer2/active
cat facts.jsonl | jq -r '.content'
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šv1.1 æ¨¡å—æœªæ‰¾åˆ°
```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /root/memory-system-skill/scripts/v1_1_*.py

# å¦‚æœç¼ºå¤±ï¼Œé‡æ–°ä¸‹è½½æˆ–å¤åˆ¶
```

### é—®é¢˜ 2ï¼šè¿‡æœŸè®°å¿†æœªæ¸…ç†
```bash
# æ‰‹åŠ¨æ‰§è¡Œ Phase 0
python3 memory.py consolidate --phase 0

# æ£€æŸ¥è¿‡æœŸæ—¥å¿—
python3 memory.py view-expired-log --limit 20
```

### é—®é¢˜ 3ï¼šè®¿é—®åŠ æˆæœªç”Ÿæ•ˆ
```bash
# æ£€æŸ¥é…ç½®
cat /root/.openclaw/workspace/memory/config.json | jq '.access_tracking'

# ç¡®ä¿ enabled: true

# é‡æ–°æ‰§è¡Œ Consolidation
python3 memory.py consolidate --force
```

---

## æ€§èƒ½ä¼˜åŒ–

### Token æ¶ˆè€—ä¼˜åŒ–
- Layer 1 å¿«ç…§æ§åˆ¶åœ¨ 2000 tokens
- è®¿é—®åŠ æˆåªå½±å“æ’åï¼Œä¸å¢åŠ  Token
- è¿‡æœŸè®°å¿†è‡ªåŠ¨æ¸…ç†ï¼Œå‡å°‘æ´»è·ƒæ± å¤§å°

### æ£€ç´¢é€Ÿåº¦ä¼˜åŒ–
- å¤šç»´ç´¢å¼•ï¼ˆå…³é”®è¯ + å®ä½“ + æ—¶é—´ï¼‰
- ä¼šè¯ç¼“å­˜ï¼ˆ30 åˆ†é’Ÿ TTLï¼‰
- åˆ†å±‚æ£€ç´¢ï¼ˆLayer 0 â†’ Layer 1 â†’ Layer 2ï¼‰

---

## æœ€ä½³å®è·µ

### 1. å®šæœŸ Consolidation
```bash
# å»ºè®®æ¯å¤©æ‰§è¡Œä¸€æ¬¡
python3 memory.py consolidate --force
```

### 2. åŠæ—¶è®°å½•è®¿é—®
```python
# åœ¨æ£€ç´¢åç«‹å³è®°å½•
result = router_search(query)
for mem in result['results']:
    record_access(mem['id'], 'used_in_response', query=query)
```

### 3. åˆç†è®¾ç½®é‡è¦æ€§
```python
# èº«ä»½/å¥åº·/å®‰å…¨ â†’ 1.0
# åå¥½/å…³ç³»/çŠ¶æ€ â†’ 0.8
# é¡¹ç›®/ä»»åŠ¡/ç›®æ ‡ â†’ 0.7
# ä¸€èˆ¬äº‹å® â†’ 0.5
# ä¸´æ—¶ä¿¡æ¯ â†’ 0.2
```

### 4. å®šæœŸæ£€æŸ¥æ—¥å¿—
```bash
# æ¯å‘¨æ£€æŸ¥ä¸€æ¬¡
python3 memory.py view-access-log --limit 50
python3 memory.py view-expired-log --limit 50
```

---

## å‚è€ƒèµ„æ–™

- [v1.1 æ›´æ–°æ—¥å¿—](docs/v1.1-changelog.md)
- [å®Œæ•´è®¾è®¡æ–‡æ¡£](/root/.openclaw/workspace/memory-system-v1.1-complete-design.md)
- [é¡¹ç›®æ—¥å¿—](/root/.openclaw/workspace/memory/2026-02-05-memory-v1.1-project-log.md)

---

**ç¥ä½¿ç”¨æ„‰å¿«ï¼** ğŸ§ 
