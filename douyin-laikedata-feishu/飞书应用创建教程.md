# 飞书自建应用创建教程

## 第一步：创建应用

1. 打开 [飞书开放平台](https://open.feishu.cn/app)
2. 使用你的飞书企业账号登录
3. 点击右上角 **"创建企业自建应用"** 按钮
4. 填写应用信息：
   - **应用名称**：巨量数据同步（或任意名称）
   - **应用描述**：自动同步巨量引擎投放数据到飞书多维表格
   - **应用图标**：可选，上传一个图标或使用默认
5. 点击 **"创建"**

---

## 第二步：获取凭证

创建成功后，会自动跳转到应用管理页面：

1. 左侧菜单点击 **"凭证与基础信息"**
2. 找到并复制保存：
   - **App ID**（例如：cli_a1b2c3d4e5f6g7h8）
   - **App Secret**（点击"查看"后复制，例如：abcdefghijklmnopqrstuvwxyz123456）

⚠️ **重要**：App Secret 只显示一次，务必保存好！

---

## 第三步：配置权限

1. 左侧菜单点击 **"权限管理"**
2. 搜索并开通以下权限：

### 必需权限：
- **多维表格相关**：
  - `bitable:app` - 查看、评论和导出多维表格
  - `bitable:record` - 查看、创建、更新和删除多维表格记录

### 可选权限（用于通知）：
- `im:message` - 获取与发送单聊、群组消息
- `im:message:send_as_bot` - 以应用的身份发消息

3. 勾选需要的权限后，点击右上角 **"保存"**

---

## 第四步：发布应用

1. 左侧菜单点击 **"版本管理与发布"**
2. 点击 **"创建版本"**
3. 填写版本信息：
   - **版本号**：1.0.0
   - **更新说明**：初始版本
   - **可用范围**：选择"全部员工"或指定部门
4. 点击 **"保存"**
5. 点击 **"申请发布"**
6. 等待管理员审核（如果你是管理员，直接通过）

---

## 第五步：授权多维表格

应用发布后，需要让它能访问你的多维表格：

### 方法一：通过多维表格设置（推荐）
1. 打开你的飞书多维表格
2. 点击右上角 **"..."** → **"高级设置"**
3. 找到 **"添加机器人"** 或 **"应用授权"**
4. 搜索你刚创建的应用名称（巨量数据同步）
5. 点击 **"添加"** 或 **"授权"**

### 方法二：通过开放平台（备选）
1. 回到开放平台应用管理页面
2. 左侧菜单点击 **"应用功能"** → **"机器人"**
3. 启用机器人功能
4. 在多维表格中 @你的机器人，完成授权

---

## 第六步：获取多维表格 ID

1. 打开你的飞书多维表格
2. 查看浏览器地址栏，格式如下：
   ```
   https://xxx.feishu.cn/base/APP_TOKEN?table=TABLE_ID&view=VIEW_ID
   ```
3. 复制保存：
   - **APP_TOKEN**（base/ 后面的部分，例如：bascnAbCdEfGhIjKlMnOpQr）
   - **TABLE_ID**（table= 后面的部分，例如：tblXxYyZz1234567890）

---

## 第七步：配置到项目

将获取的信息填入 `.env` 文件：

```bash
# 复制配置模板
cp .env.example .env

# 编辑 .env 文件
nano .env
```

填入内容：
```env
# 飞书配置
FEISHU_APP_ID=cli_a1b2c3d4e5f6g7h8
FEISHU_APP_SECRET=abcdefghijklmnopqrstuvwxyz123456
FEISHU_APP_TOKEN=bascnAbCdEfGhIjKlMnOpQr
FEISHU_TABLE_ID=tblXxYyZz1234567890
```

---

## 验证配置

运行测试脚本验证配置是否正确：

```bash
cd /root/.openclaw/workspace/douyin-laikedata-feishu
python3 test_feishu.py
```

如果看到 "✅ 飞书配置正确"，说明配置成功！

---

## 常见问题

### Q1: 找不到"创建企业自建应用"按钮？
**A**: 确认你的账号有管理员权限。如果没有，联系企业管理员开通。

### Q2: 权限申请后无法保存？
**A**: 部分权限需要管理员审批，等待审批通过后再保存。

### Q3: 应用无法访问多维表格？
**A**: 确保完成了"第五步：授权多维表格"，应用必须被添加到表格中才能访问。

### Q4: App Secret 忘记了怎么办？
**A**: 在"凭证与基础信息"页面点击"重置 Secret"，会生成新的（旧的立即失效）。

---

## 下一步

配置完成后，告诉我：
1. ✅ 飞书应用已创建
2. ✅ 已获取 App ID 和 App Secret
3. ✅ 已获取多维表格的 APP_TOKEN 和 TABLE_ID

我会继续完善代码，实现自动同步功能。
