# Access Token è‡ªåŠ¨ç»­æœŸåŠŸèƒ½è¯´æ˜

## âœ… å·²å®ç°åŠŸèƒ½

### 1. Token ç¼“å­˜ç®¡ç†
- æ–‡ä»¶ä½ç½®ï¼š`.token_cache.json`
- åŒ…å«ä¿¡æ¯ï¼š
  - `access_token`: è®¿é—®ä»¤ç‰Œ
  - `refresh_token`: åˆ·æ–°ä»¤ç‰Œ
  - `expires_at`: è®¿é—®ä»¤ç‰Œè¿‡æœŸæ—¶é—´
  - `refresh_expires_at`: åˆ·æ–°ä»¤ç‰Œè¿‡æœŸæ—¶é—´
  - `updated_at`: æœ€åæ›´æ–°æ—¶é—´

### 2. è‡ªåŠ¨ç»­æœŸé€»è¾‘
- **æ£€æŸ¥æ—¶æœº**ï¼šæ¯æ¬¡è°ƒç”¨ `get_valid_token()` æ—¶
- **ç»­æœŸæ¡ä»¶**ï¼šAccess Token å‰©ä½™æ—¶é—´ < 1å°æ—¶
- **ç»­æœŸæ–¹å¼**ï¼šä½¿ç”¨ Refresh Token è‡ªåŠ¨åˆ·æ–°
- **æœ‰æ•ˆæœŸ**ï¼š
  - Access Token: 24å°æ—¶
  - Refresh Token: 30å¤©

### 3. æ ¸å¿ƒæ–‡ä»¶

#### `token_manager.py` - Token ç®¡ç†å™¨
```bash
# æŸ¥çœ‹çŠ¶æ€
python3 token_manager.py status

# æ‰‹åŠ¨åˆ·æ–°
python3 token_manager.py refresh

# è·å–æœ‰æ•ˆtoken
python3 token_manager.py get
```

#### `init_token.py` - åˆå§‹åŒ–è„šæœ¬
é¦–æ¬¡è¿è¡Œæ—¶åˆå§‹åŒ– token ç¼“å­˜

#### `sync_data.py` - å·²é›†æˆè‡ªåŠ¨ç»­æœŸ
åŒæ­¥è„šæœ¬ä¼šè‡ªåŠ¨ä½¿ç”¨ `get_valid_token()` è·å–æœ‰æ•ˆ token

## ğŸ”„ å·¥ä½œæµç¨‹

```
1. è°ƒç”¨ get_valid_token()
   â†“
2. æ£€æŸ¥ç¼“å­˜çš„ token
   â†“
3. åˆ¤æ–­æ˜¯å¦å³å°†è¿‡æœŸï¼ˆ< 1å°æ—¶ï¼‰
   â”œâ”€ å¦ â†’ ç›´æ¥è¿”å›ç¼“å­˜çš„ token
   â””â”€ æ˜¯ â†’ ä½¿ç”¨ refresh_token åˆ·æ–°
       â†“
       è·å–æ–°çš„ access_token å’Œ refresh_token
       â†“
       æ›´æ–°ç¼“å­˜
       â†“
       è¿”å›æ–° token
```

## ğŸ“Š æµ‹è¯•ç»“æœ

### æµ‹è¯•åœºæ™¯1ï¼šæ­£å¸¸ä½¿ç”¨
- âœ… Token å‰©ä½™ 22.8 å°æ—¶
- âœ… ç›´æ¥ä½¿ç”¨ç¼“å­˜çš„ token
- âœ… åŒæ­¥æˆåŠŸ

### æµ‹è¯•åœºæ™¯2ï¼šå³å°†è¿‡æœŸ
- âœ… æ¨¡æ‹Ÿ token å‰©ä½™ 30 åˆ†é’Ÿ
- âœ… è‡ªåŠ¨è§¦å‘åˆ·æ–°
- âœ… è·å–æ–° tokenï¼ˆæœ‰æ•ˆæœŸ 24 å°æ—¶ï¼‰
- âœ… åŒæ­¥æˆåŠŸ

## âš ï¸ æ³¨æ„äº‹é¡¹

### Refresh Token è¿‡æœŸ
- Refresh Token æœ‰æ•ˆæœŸï¼š30å¤©
- å¦‚æœ Refresh Token ä¹Ÿè¿‡æœŸï¼Œéœ€è¦é‡æ–°æˆæƒ
- å»ºè®®åœ¨è¿‡æœŸå‰7å¤©æ”¶åˆ°æé†’

### é‡æ–°æˆæƒæ­¥éª¤
1. è®¿é—®æˆæƒé¡µé¢ï¼š
   ```
   https://ad.oceanengine.com/openapi/audit/oauth.html?app_id=1856818099350592&state=your_state&scope=4,100000014
   ```

2. è·å– auth_code

3. è¿è¡Œï¼š
   ```bash
   python3 get_token.py <auth_code>
   ```

## ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜åŒ–

### 1. Refresh Token è¿‡æœŸæé†’
- åœ¨ Refresh Token å‰©ä½™ < 7å¤©æ—¶å‘é€é€šçŸ¥
- å¯ä»¥é€šè¿‡é£ä¹¦æœºå™¨äººæˆ–é‚®ä»¶æé†’

### 2. å¤±è´¥é‡è¯•æœºåˆ¶
- Token åˆ·æ–°å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•
- é‡è¯•3æ¬¡åå‘é€å‘Šè­¦

### 3. ç›‘æ§å’Œæ—¥å¿—
- è®°å½•æ¯æ¬¡ token åˆ·æ–°çš„æ—¶é—´
- ç»Ÿè®¡åˆ·æ–°æˆåŠŸç‡
- å¼‚å¸¸æƒ…å†µå‘Šè­¦

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### åœ¨è„šæœ¬ä¸­ä½¿ç”¨
```python
from token_manager import get_valid_token

# è·å–æœ‰æ•ˆçš„ access tokenï¼ˆè‡ªåŠ¨ç»­æœŸï¼‰
access_token = get_valid_token()

if access_token:
    # ä½¿ç”¨ token è°ƒç”¨ API
    headers = {"Access-Token": access_token}
    # ...
else:
    # Token è·å–å¤±è´¥ï¼Œéœ€è¦é‡æ–°æˆæƒ
    print("éœ€è¦é‡æ–°æˆæƒ")
```

### å®šæ—¶ä»»åŠ¡
å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©7:00ï¼‰ä¼šè‡ªåŠ¨ä½¿ç”¨ `get_valid_token()`ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„ã€‚

## âœ… æ€»ç»“

Access Token è‡ªåŠ¨ç»­æœŸåŠŸèƒ½å·²å®Œå…¨å®ç°å¹¶æµ‹è¯•é€šè¿‡ï¼š
- âœ… è‡ªåŠ¨æ£€æµ‹ token è¿‡æœŸ
- âœ… è‡ªåŠ¨åˆ·æ–° token
- âœ… ç¼“å­˜ç®¡ç†
- âœ… é›†æˆåˆ°åŒæ­¥è„šæœ¬
- âœ… æµ‹è¯•éªŒè¯æˆåŠŸ

**æ˜å¤©çš„å®šæ—¶ä»»åŠ¡å°†è‡ªåŠ¨ä½¿ç”¨æ–°çš„ tokenï¼Œä¸ä¼šå‡ºç°åŒæ­¥å¤±è´¥çš„é—®é¢˜ï¼**
