# 失败通知快速配置指南

## 5分钟配置完成

### 第1步：创建飞书机器人（2分钟）

1. 打开飞书，进入你想接收通知的群聊
2. 点击右上角 "..." → "机器人" → "添加机器人"
3. 选择 "自定义机器人"
4. 填写信息：
   - 名称：数据同步助手
   - 描述：抖音来客数据同步状态通知
5. 点击 "添加"
6. **复制 Webhook URL**（重要！）

### 第2步：配置到项目（1分钟）

编辑 `.env` 文件，添加一行：

```bash
FEISHU_WEBHOOK_URL=https://open.feishu.cn/open-apis/bot/v2/hook/你的webhook地址
```

保存文件。

### 第3步：测试通知（2分钟）

运行测试脚本：

```bash
cd /root/.openclaw/workspace/douyin-laikedata-feishu
python3 notifier.py
```

如果配置正确，你会在飞书群里收到 4 条测试消息。

### 完成！

现在每次同步任务失败时，你都会收到飞书通知。

---

## 通知内容

### 你会收到的通知

✅ **同步成功**（每天早上7点后）
- 日期
- 记录数
- 总消耗
- 总转化
- 平均转化成本

❌ **同步失败**（出错时）
- 日期
- 错误信息
- 详细原因
- 建议操作

⚠️ **Token 刷新失败**（Token 过期时）
- 错误信息
- 需要重新授权提醒

---

## 常见问题

### Q: 收不到通知？

**检查清单**:
1. Webhook URL 是否正确复制
2. `.env` 文件是否保存
3. 机器人是否在群里
4. 运行 `python3 notifier.py` 看是否有错误

### Q: 通知太多？

**解决方案**:
编辑 `sync_data.py`，找到这段代码：

```python
if notifier:
    if success_count == len(records):
        # 全部成功
        notifier.notify_sync_success(...)  # 注释这行就不会发送成功通知
```

### Q: 想要更详细的通知？

**解决方案**:
编辑 `notifier.py`，修改 `notify_sync_success()` 或 `notify_sync_failed()` 方法，添加更多字段。

---

## 安全提醒

⚠️ **不要公开 Webhook URL**
- 任何人拿到 URL 都可以发消息到你的群
- 不要提交到 Git 仓库（已自动忽略）
- 不要分享给他人

---

## 下一步

配置完成后，建议：

1. **手动测试一次同步**
   ```bash
   python3 sync_data.py
   ```
   看是否收到成功通知

2. **等待明天早上7点**
   定时任务会自动运行，如果失败会收到通知

3. **查看通知历史**
   在飞书群里可以看到所有历史通知

---

**配置完成！享受自动化的便利吧 🎉**
