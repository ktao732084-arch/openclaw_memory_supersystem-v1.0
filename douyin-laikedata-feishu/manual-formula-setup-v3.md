# 飞书多维表格公式配置指南（最终版）

## 客资数据表已创建
✅ 表格ID: tblYgY0c0PRVqoqe
✅ 已保存到 .env 文件

---

## 配置公式字段

### 操作步骤

1. **打开飞书多维表格**
   - 访问：https://ocnbk46uzxq8.feishu.cn/base/FEiCbGEDHarzyUsPG8QcoLxwn7d
   - 打开"投放数据"表格（主表）

---

## 公式1：客资数量

**字段名称**：`客资数量`  
**字段类型**：公式

**公式内容**：
```
[客资数据].[手机号].FILTER(
  AND(
    [客资数据].[单元ID前15位] = LEFT([单元ID], 15),
    [客资数据].[日期] = [时间]
  )
).COUNTA()
```

**说明**：
- 从客资数据表的"手机号"字段中筛选
- 筛选条件：单元ID前15位匹配 且 日期匹配
- 统计筛选后的记录数

**关键修改**：
- ✅ 必须指定结果列：`[客资数据].[手机号]`
- ✅ 在FILTER中使用完整的表格.字段引用

---

## 公式2：实际获客成本

**字段名称**：`实际获客成本`  
**字段类型**：公式

**公式内容**：
```
IF([客资数量] > 0, [消耗(元)] / [客资数量], 0)
```

**说明**：
- 如果客资数量大于0，则计算：消耗 ÷ 客资数量
- 否则返回0

---

## 公式3：客资转化率(%)

**字段名称**：`客资转化率(%)`  
**字段类型**：公式

**公式内容**：
```
IF([客资数量] > 0, ([转化数] / [客资数量]) * 100, 0)
```

**说明**：
- 如果客资数量大于0，则计算：(转化数 ÷ 客资数量) × 100
- 否则返回0

---

## 字段名称对照表

请确认以下字段名称与你的表格完全一致：

### 投放数据表（主表）
- `单元ID` - 单元ID字段
- `时间` - 日期字段
- `消耗(元)` - 消耗金额字段
- `转化数` - 转化数量字段

### 客资数据表
- 表格名称：`客资数据`
- `手机号` - 手机号字段
- `单元ID前15位` - 单元ID前15位字段
- `日期` - 日期字段

---

## 配置步骤

### 步骤1：添加"客资数量"字段

1. 在投放数据表中，点击右侧的"+"添加字段
2. 字段名称：`客资数量`
3. 字段类型：选择"公式"
4. 复制粘贴公式1
5. 点击"确定"

### 步骤2：添加"实际获客成本"字段

1. 点击右侧的"+"添加字段
2. 字段名称：`实际获客成本`
3. 字段类型：选择"公式"
4. 复制粘贴公式2
5. 点击"确定"

### 步骤3：添加"客资转化率(%)"字段

1. 点击右侧的"+"添加字段
2. 字段名称：`客资转化率(%)`
3. 字段类型：选择"公式"
4. 复制粘贴公式3
5. 点击"确定"

---

## 公式语法说明

### FILTER 函数的正确用法

**错误写法**：
```
[表格].FILTER(条件)  ❌ 缺少结果列
```

**正确写法**：
```
[表格].[字段].FILTER(条件)  ✅ 指定结果列
```

### 在 FILTER 中引用字段

**在筛选条件中**：
- 使用 `[表格].[字段]` 引用被筛选表格的字段
- 使用 `[字段]` 引用当前表格的字段

**示例**：
```
[客资数据].[手机号].FILTER(
  [客资数据].[单元ID前15位] = LEFT([单元ID], 15)
)
```

---

## 测试验证

配置完成后：

1. 查看投放数据表中的任意一条记录
2. 检查"客资数量"字段是否显示数字（可能为0）
3. 检查"实际获客成本"和"客资转化率(%)"是否自动计算

如果显示错误（如 #ERROR!），请：
1. 检查字段名称是否完全匹配（包括括号、空格）
2. 检查表格名称是否为"客资数据"
3. 截图错误信息发给我

---

## 完成后

配置完成后，回复"公式字段已配置"，我将帮你测试验证！
